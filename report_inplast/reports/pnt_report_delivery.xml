<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Todos los templates para picking deben tener prioridad 922 para el filtro del M2O -->
    <template id="pnt_report_delivery_document" name="Custom Delivery Document">
        <t t-name="pnt_report_delivery_document">
            <t t-call="web.html_container">
                <t t-call="stock.report_delivery_document"/>
                <t t-set="lines" t-value="o.move_ids"/>
                <t t-foreach="lines" t-as="line">
                    <t t-if="o.partner_id.pnt_picking_report_id.coa" t-call="report_inplast.coa_product_document_a"/>
                    <t t-if="o.partner_id.pnt_picking_report_id.coa_handle" t-call="report_inplast.coa_product_handle_document"/>
                    <t t-if="o.partner_id.pnt_picking_report_id.components_table"
                       t-call="report_inplast.coa_product_document_attachment"/>
                    <t t-if="o.partner_id.pnt_picking_report_id.coa_batch_certificate"
                       t-call="report_inplast.coa_product_batch_certificate_document"/>
                </t>
                <t t-if="o.carrier_id.pnt_print_picking_list" t-call="report_inplast.packing_list"/>
            </t>
        </t>
    </template>

    <record id="inplast_report_picking_attachments" model="ir.ui.view">
        <field name="name">inplast.report.picking.attachments</field>
        <field name="inherit_id" ref="stock.report_delivery_document"/>
        <field name="arch" type="xml">
            <xpath expr="//table[@name='stock_move_table']/thead" position="replace">

                <thead>
                    <tr style="border: 1px solid black; padding: 5px;">
                        <th name="th_sm_codigo">
                            <strong>Codigo</strong>
                        </th>
                        <th name="th_sm_n_pedido">
                        <strong>NºPedido</strong>
                        </th>
                        <th name="th_sm_cantidad">
                            <strong>Cantidad</strong>
                        </th>
                        <th name="th_sm_descripcion">
                            <strong>Descripcion</strong>
                        </th>
                        <th name="th_sm_cajas_unidades">
                            <strong>Cajas/Unidades</strong>
                        </th>
                    </tr>
                </thead>
            </xpath>
            <xpath expr="//table[@name='stock_move_table']/tbody" position="replace">
                <tbody>
                    <t t-set="lines" t-value="o.move_ids.filtered(lambda x: x.product_uom_qty)"/>
                    <t t-set="total_quantity" t-value="sum(line.quantity for line in lines)"/>
                    <t t-set="total_quantity_box" t-value="sum((line.product_id.pnt_box_qty)*line.quantity for line in lines)"/>


                    <t t-set="total_quantity_weight"
                       t-value="sum(line.product_id.weight * line.quantity for line in lines)"/>
                    <tr t-foreach="lines" t-as="move">
                        <td>
                            <span t-field="move.product_id">Customizable Desk</span>
                            <p t-if="move.description_picking and move.description_picking != move.product_id.name and move.description_picking != move.product_id.display_name">
                                <span t-field="move.description_picking">Description on transfer</span>
                            </p>
                        </td>
                        <td>
                            <span t-field="o.name">3.00</span>
                        </td>
                         <td>
                            <span t-field="move.quantity">3.00</span>
                        </td>
                        <td>
                            <span t-field="move.description_picking">3.00</span>
                        </td>
                        <td>
                            <span t-field="move.product_id.pnt_parent_qty">3.00</span>
                        </td>
                    </tr>
                </tbody>


            </xpath>


            <xpath expr="//div[@t-if='not o.signature']" position="before">



                <div style="width: 65%;">
                    <t t-set="company" t-value="o.company_id"/>
                    <img t-if="company.pnt_goods_state_table" t-att-src="image_data_uri(company.pnt_goods_state_table)"
                         alt="Company Image"/>
                </div>
                <div style="margin-top: 20px;">
                    <strong>Total bultos:</strong>
                    <span t-esc="total_quantity"/>
                    <br/>
                    <strong style="margin-top: 5px;">Total cajas:</strong>
                    <span t-esc="total_quantity_box">0</span>
                    <br/>
                    <strong style="margin-top: 5px;">Total peso neto:</strong>
                    <span t-esc="o.weight"/>
                    <br/>
                    <strong style="margin-top: 5px;">Total peso bruto:</strong>
                    <span t-esc="o.shipping_weight"/>
                    <br/>
                </div>
                <div class="row" style="margin-top: 20px;">
                    <div class="col-4">
                        <strong style="border: 2px solid #000000; padding: 5px; text-align: left;background-color:#D3D3D3;">
                            Nº Pedido:
                        </strong>
                        <span style="margin-left: 5px" t-field="o.sale_id.client_order_ref"/>
                    </div>
                    <div class="col-offset-8 col-4">
                        <strong style="border: 2px solid #000000; padding: 5px; text-align: left;background-color:#D3D3D3;">
                            Agencia de Transporte:
                        </strong>
                        <span style="margin-left: 5px" t-field="o.carrier_id"/>
                    </div>
                    <div class="col-offset-16 col-4 ">
                        <strong style="border: 2px solid #000000; padding: 5px; text-align: left; background-color:#D3D3D3;">
                            Fecha:
                        </strong>
                        <span style="margin-left: 5px" t-esc="o.date.strftime('%d/%m/%Y')"/>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <p>El poseedor final de los residuos de envases y embalajes usados deberá entregarlos en condiciones
                        adecuadas de separación por materiales a un agente ecológico para su reutilización a un
                        recuperador, a un reciclador o a un valorizador autorizados.\n Inscrita en el Registro Mercantil
                        de Alicante: Tomo 1.712 General, Folio 11. Hoja nº. A-27.348. Inscripción 1ª, 14-6-1994 - C.I.F.
                        A-03946472
                    </p>
                </div>


            </xpath>
            <xpath expr="//t[@t-set='address']" position="replace">
                <div style="height:30px;"></div>
                <div class="row">
                    <div class="col-6">
                    </div>
                    <div class="col-offset-6 col-6">
                        <strong t-field="o.name">WH/OUT/0001</strong>
                    </div>
                </div>
                <div class="row justify-content-center align-items-center">

                    <div class="col-6 text-center"
                         style=" border: 1px solid black;height: 30px;background-color:#D3D3D3;">
                        <strong style="text-align: center;width: 100%;">Cliente</strong>
                    </div>
                    <div class="col-offset-6 col-6 text-center"
                         style=" border: 1px solid black;height: 30px;background-color:#D3D3D3; margin-left 3px">
                        <strong>Plaza</strong>
                    </div>
                </div>
                <div class="row gx-2">
                    <div class="col-5 col-auto">
                        <strong t-field="o.partner_id"/>
                    </div>
                    <div class="col-2 col-auto">
                        <span t-field="o.partner_id.phone"/>
                    </div>
                    <div class="col-5 col-auto">
                        <span t-field="o.partner_id.street" style="margin-left 15px"/>
                        <span t-field="o.partner_id.zip"/>
                    </div>
                    <div class="col-2 col-auto">
                        <span t-field="o.partner_id.state_id.name"/>
                    </div>
                </div>

            </xpath>
            <xpath expr="//div[@class='page']/h2/span[@t-field='o.name']" position="replace">

            </xpath>
            <xpath expr="//div[contains(@class, 'row') and contains(@class, 'mt32') and contains(@class, 'mb32')]" position="replace">
            </xpath>


        </field>
        <field name="priority">99</field>
    </record>


</odoo>